"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}();!function(t,e,a){var i=function(){function i(e,a){return _classCallCheck(this,i),this.$element=e,this.$element.is('input[type="text"]')?(this.options=t.extend({},i.defaults,this.$element.data(),a),this._init(),Foundation.registerPlugin(this,"Datepicker"),void Foundation.Keyboard.register("Datepicker",{ENTER:"open",ESCAPE:"close",TAB:"tab_forward",SHIFT_TAB:"tab_backward"})):void console.warn('The datepicker can only be used on an <input> element with type="text".')}return _createClass(i,[{key:"_init",value:function(){var e=Foundation.GetYoDigits(6,"datepicker"),i=Foundation.GetYoDigits(6,"datapicker-dropdown");a.updateLocale(this.options.locale,{week:{dow:this.options.weekstart}}),a.locale(this.options.locale),this.$element.attr({id:e,"data-toggle":i}),this.$dropdown=t('<div id="'+i+'" class="datepicker-dropdown" data-dropdown></div>'),this.$dropdown.attr({"data-v-offset":0,"data-h-offset":0,"data-close-on-click":this.options.closeOnClick}),this.$element.after(this.$dropdown),this.$dropdown.foundation(),this.$date=""==this.$element.val()?a().startOf("date"):a(this.$element.val(),this.options.format,!0),this.$viewDate=this.$date.clone(),this._events(),this.currentMonth=a().startOf("month"),this.selectedDate=a()}},{key:"_buildCalendar",value:function(){var e=t('<div class="datepicker-calendar">'),i=t("<nav>"+this.$viewDate.format("MMMM YYYY")+"</nav>"),s=t('<a data-date-nav="month" data-method="subtract"><i class="fa fa-chevron-left"></i></a>'),n=t('<a data-date-nav="month" data-method="add"><i class="fa fa-chevron-right"></i></a>'),o=t('<div class="weekdays row small-up-7 collapse">'),d=t('<div class="days row small-up-7 collapse">'),r=a(this.$viewDate.format("YYYY-MM-DD")),l=r.clone();e.append(i),i.prepend(s).append(n),e.append(o);for(var h=this.options.weekstart;h<this.options.weekstart+7;h++){var c=h;c>6&&(c-=7);var m=a().day(c).format("ddd");o.append(t('<div class="column">'+m+"</div>"))}for(e.append(d),r.startOf("month"),r.startOf("week"),l.endOf("month"),l.endOf("week"),r;!r.isAfter(l.format("YYYY-MM-DD"));r.add(1,"day")){var u=r.isSame(this.$date.format("YYYY-MM-DD"),"day")?"current":r.isSame(this.$date.format("YYYY-MM-DD"),"month")?r.isSame(a().format("YYYY-MM-DD"),"day")?"same-month today":"same-month":"other-month";d.append(t('<div class="column"><a class="'+u+'" data-set-date="'+r.format("YYYY-MM-DD")+'">'+r.date()+"</a></div>"))}this.$dropdown.empty(),this.$dropdown.append(e),e.foundation(),this.$element.focus(),this._calendarEvents()}},{key:"_calendarEvents",value:function(){this.$dropdown.find("a[data-date-nav]").off("click").on("click",this._navigateDate.bind(this)),this.$dropdown.find("a[data-set-date]").off("click").on("click",this._setDate.bind(this))}},{key:"_navigateDate",value:function(e){var a=t(e.currentTarget).data();this.navigateDate(a.dateNav,a.method)}},{key:"_setDate",value:function(e){var i=a(t(e.currentTarget).data("set-date"));this.setDate(i.get("year"),i.get("month"),i.get("date"))}},{key:"navigateDate",value:function(t,e){this.$viewDate[e](1,t),this._buildCalendar()}},{key:"setDate",value:function(t,e,a){this.$date.set({year:t,month:e,date:a}),this.$element.val(this.$date.format(this.options.format)),this.$viewDate=this.$date.clone(),this.options.closeOnSelect&&!this.options.time?this.$dropdown.trigger("close"):this.options.time?this._buildCalendar():this._buildCalendar()}},{key:"buildCalendarDays",value:function(t){var i="",s=a(t.format("YYYY-MM-DD")),n=a(this.currentMonth.format("YYYY-MM-DD"));n.startOf("month");var o=n.clone();for(o.endOf("month"),n.startOf("week"),o.endOf("week"),n;!n.isAfter(o.format("YYYY-MM-DD"));n.add(1,"day")){var d=n.isSame(s.format("YYYY-MM-DD"),"day")?"current":n.isSame(this.currentMonth.format("YYYY-MM-DD"),"month")?n.isSame(a().format("YYYY-MM-DD"),"day")?"same-month today":"same-month":"other-month";i+=e.render(this.options.dayTemplate,{dayType:d,date:n.format(this.options.format),day:n.date()})}return i}},{key:"buildWeekDaysheader",value:function(){for(var t="",i=this.options.weekstart,s=i;i+7>s;s++){var n=s;n>6&&(n-=7);var o=a().day(n).format("ddd");t+=e.render(this.options.weekdayHeaderTemplate,{dayType:"weekday-header",day:o})}return t}},{key:"buildCalendar",value:function(){this.preventFalseBodyClick=!0,this.$dropdown.html("");var i=""==this.$element.val()?a().startOf("date"):a(this.$element.val(),this.options.format,!0),s={month:this.currentMonth.format("MMMM YYYY"),weekdays:this.weekDaysHeader,days:this.buildCalendarDays(i)},n=t(e.render(this.options.calendarTemplate,s));n.on("click",".months-nav > a",this.navigateMonths.bind(this)).on("click",".day",this.selectDay.bind(this)),this.$dropdown.append(n)}},{key:"buildTimePicker",value:function(){this.preventFalseBodyClick=!0,this.$dropdown.html("");var a=["hour","minute"];this.options.meridiem&&a.push("meridiem");var i=this.buildHours(),s=this.buildMinutes(),n=this.options.meridiem?this.buildMeridien():"",o={date:this.selectedDate.format("DD MMMM YYYY"),coll_count:a.length,timeparts:i+s+n},d=t(e.render(this.options.timePickerTemplate,o));d.on("click",".nav-datepicker",this.buildCalendar.bind(this)).on("click",".hour-up:not(.disabled)",this.addHour.bind(this)).on("click",".hour-down:not(.disabled)",this.subtractHour.bind(this)).on("click",".minute-up:not(.disabled)",this.addMinute.bind(this)).on("click",".minute-down:not(.disabled)",this.subtractMinute.bind(this)).on("click",".meridiem-up:not(.disabled)",this.addMeridiem.bind(this)).on("click",".meridiem-down:not(.disabled)",this.subtractMeridiem.bind(this)).on("click",".close-datepicker",this.close.bind(this)),this.$dropdown.append(d)}},{key:"buildHours",value:function(){var t=[];return t=this.options.meridiem?["11","10","09","08","07","06","05","04","03","02","01","12"]:["23","22","21","20","19","18","17","16","15","14","13","12","11","10","09","08","07","06","05","04","03","02","01","00"],this.buildTimePartSelector(t,"hour")}},{key:"buildMinutes",value:function(){for(var t=[],e=60-this.options.minuteInterval;e>=0;e-=this.options.minuteInterval)t.push(10>e?"0"+e:""+e);return this.buildTimePartSelector(t,"minute")}},{key:"buildMeridien",value:function(){return this.buildTimePartSelector(["PM","AM"],"meridiem")}},{key:"buildTimePartSelector",value:function(a,i){var s=this,n="";return t.each(a,function(t,a){n+=e.render(s.options.timeOptionTemplate,{option:a,timepart:i})}),e.render(this.options.timePartSelectorTemplate,{options:n,timepart:i})}},{key:"navigateMonths",value:function(e){return t(e.currentTarget).hasClass("month-nav-next")&&this.currentMonth.add(1,"month"),t(e.currentTarget).hasClass("month-nav-previous")&&this.currentMonth.subtract(1,"month"),this.buildCalendar(),!1}},{key:"selectDay",value:function(e){this.$element.val(t(e.currentTarget).data("date")),this.selectedDate=a(t(e.currentTarget).data("date"),this.options.format),this.currentMonth=this.selectedDate.clone().startOf("month"),this.options.time?this.buildTimePicker():this.$dropdown.trigger("close")}},{key:"addHour",value:function(e){this.selectedDate.add(1,"hours"),this.$element.val(this.selectedDate.format(this.options.format));var a=t(e.target).parent();t(".hour-down").removeClass("disabled");var i=this.options.meridiem?this.selectedDate.format("hh"):this.selectedDate.format("HH"),s=a.find("."+i+"-hour"),n=Foundation.Box.GetDimensions(s),o=n.height+n.offset.top-(n.parentDims.height+n.parentDims.offset.top);s.parent().animate({bottom:o+"px"},"600","swing"),s.is(":first-child")&&t(e.target).addClass("disabled")}},{key:"subtractHour",value:function(e){this.selectedDate.subtract(1,"hours"),this.$element.val(this.selectedDate.format(this.options.format));var a=t(e.target).parent();t(".hour-up").removeClass("disabled");var i=this.options.meridiem?this.selectedDate.format("hh"):this.selectedDate.format("HH"),s=a.find("."+i+"-hour"),n=Foundation.Box.GetDimensions(s),o=n.height+n.offset.top-(n.parentDims.height+n.parentDims.offset.top);s.parent().animate({bottom:o+"px"},"600","swing"),s.is(":last-child")&&t(e.target).addClass("disabled")}},{key:"addMinute",value:function(e){this.selectedDate.add(this.options.minuteInterval,"minutes"),this.$element.val(this.selectedDate.format(this.options.format));var a=t(e.target).parent();t(".minute-down").removeClass("disabled");var i=this.selectedDate.format("mm"),s=a.find("."+i+"-minute"),n=Foundation.Box.GetDimensions(s),o=n.height+n.offset.top-(n.parentDims.height+n.parentDims.offset.top);s.parent().animate({bottom:o+"px"},"600","swing"),s.is(":first-child")&&t(e.target).addClass("disabled")}},{key:"subtractMinute",value:function(e){this.selectedDate.subtract(this.options.minuteInterval,"minutes"),this.$element.val(this.selectedDate.format(this.options.format));var a=t(e.target).parent();t(".minute-up").removeClass("disabled");var i=this.selectedDate.format("mm"),s=a.find("."+i+"-minute"),n=Foundation.Box.GetDimensions(s),o=n.height+n.offset.top-(n.parentDims.height+n.parentDims.offset.top);s.parent().animate({bottom:o+"px"},"600","swing"),s.is(":last-child")&&t(e.target).addClass("disabled")}},{key:"addMeridiem",value:function(e){this.selectedDate.add(12,"hours"),this.$element.val(this.selectedDate.format(this.options.format));var a=t(e.target).parent();t(".meridiem-down").removeClass("disabled");var i=this.selectedDate.format("A"),s=a.find("."+i+"-meridiem"),n=Foundation.Box.GetDimensions(s),o=n.height+n.offset.top-(n.parentDims.height+n.parentDims.offset.top);s.parent().animate({bottom:o+"px"},"600","swing"),s.is(":first-child")&&t(e.target).addClass("disabled")}},{key:"subtractMeridiem",value:function(e){this.selectedDate.subtract(12,"hours"),this.$element.val(this.selectedDate.format(this.options.format));var a=t(e.target).parent();t(".meridiem-up").removeClass("disabled");var i=this.selectedDate.format("A"),s=a.find("."+i+"-meridiem"),n=Foundation.Box.GetDimensions(s),o=n.height+n.offset.top-(n.parentDims.height+n.parentDims.offset.top);s.parent().animate({bottom:o+"px"},"600","swing"),s.is(":last-child")&&t(e.target).addClass("disabled")}},{key:"_events",value:function(){var e=this;this.$dropdown.on("show.zf.datepicker",this._buildCalendar.bind(this)),this.$element.add(this.$dropdown).off("keydown.zf.dropdown").on("keydown.zf.datepicker",function(a){var i=t(this);Foundation.Keyboard.handleKey(a,"Datepicker",{tab_forward:function(){e.$dropdown.trigger("close")},tab_backward:function(){e.$dropdown.trigger("close")},open:function(){i.is(e.$element)&&(e.$dropdown.trigger("open"),a.preventDefault())},close:function(){e.$dropdown.trigger("close"),e.$element.focus()}})}),this._triggers()}},{key:"_triggers",value:function(){var t=this;this.$dropdown.on("show.zf.dropdown",function(e){console.log("dropdown opening"),t.$dropdown.trigger("show.zf.datepicker")})}},{key:"destroy",value:function(){this.$dropdown.remove(),this.$element.off(".zf.datepicker"),Foundation.unregisterPlugin(this)}}]),i}();i.defaults={closeOnClick:!0,closeOnSelect:!0,format:"YYYY-MM-DD",locale:"en",weekstart:0,time:!1,meridiem:!1,minuteInterval:15,calendarTemplate:'<div class="foundation-calendar"><div class="calendar-header"><div class="months-nav"><a class="month-nav-previous"><i class="fa fa-chevron-left fi-arrow-left"></i></a><div>{{month}}</div><a class="month-nav-next"><i class="fa fa-chevron-right fi-arrow-right"></i></a></div><div class="weekdays row small-up-7 collapse">{{{weekdays}}}</div></div><div class="days row small-up-7 collapse">{{{days}}}</div></div>',weekdayHeaderTemplate:'<div class="column day {{dayType}}"><strong>{{day}}</strong></div>',dayTemplate:'<div class="column"><a class="day {{dayType}}" data-date="{{date}}">{{day}}</a></div>',timePickerTemplate:'<div class="foundation-calendar"><div class="calendar-header"><a class="nav-datepicker">{{date}}</a></div><div class="timepicker row small-up-{{coll_count}} collapse">{{{timeparts}}}</div><a class="close-datepicker">Ok</a></div>',timePartSelectorTemplate:'<div class="column {{timepart}}"><a class="button primary expanded {{timepart}}-up"><i class="fa fa-chevron-up fi-arrow-up"></i></a><div class="timepart-options-container"><div class="options">{{{options}}}</div></div><a class="button primary expanded {{timepart}}-down disabled"><i class="fa fa-chevron-down fi-arrow-down"></i></a></div>',timeOptionTemplate:'<div class="time-option {{option}}-{{timepart}}">{{option}}</div>'},Foundation.plugin(i,"Datepicker")}(jQuery,Mustache,moment);